(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{83:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return i})),t.d(n,"toc",(function(){return s})),t.d(n,"default",(function(){return p}));var r=t(3),a=t(7),c=(t(0),t(88)),o={title:"Dockerfiles"},i={unversionedId:"Microservicios/Docker/dockerfiles",id:"Microservicios/Docker/dockerfiles",isDocsHomePage:!1,title:"Dockerfiles",description:"Apache PHP TLS SSL",source:"@site/docs/Microservicios/Docker/dockerfiles.md",sourceDirName:"Microservicios/Docker",slug:"/Microservicios/Docker/dockerfiles",permalink:"/documentation/Microservicios/Docker/dockerfiles",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/Microservicios/Docker/dockerfiles.md",version:"current",frontMatter:{title:"Dockerfiles"},sidebar:"tutorialSidebar",previous:{title:"Aliases",permalink:"/documentation/Microservicios/Docker/aliases"},next:{title:"Referencia",permalink:"/documentation/Servidores/Apache/0referencia"}},s=[{value:"Apache PHP TLS SSL",id:"apache-php-tls-ssl",children:[]},{value:"Crear usuario",id:"crear-usuario",children:[]},{value:"Buenas pr\xe1cticas",id:"buenas-pr\xe1cticas",children:[]},{value:"CentOS systemd",id:"centos-systemd",children:[]},{value:"Dockerfile FULL",id:"dockerfile-full",children:[]},{value:"Dockerfile FULL 2",id:"dockerfile-full-2",children:[]},{value:"Escenarios m\xfaltiples",id:"escenarios-m\xfaltiples",children:[]},{value:"NGINX PHP FPM",id:"nginx-php-fpm",children:[]}],l={toc:s};function p(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(c.b)("wrapper",Object(r.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(c.b)("h2",{id:"apache-php-tls-ssl"},"Apache PHP TLS SSL"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},"# Archivos\nDockerfile\ndocker.csr # Solicitud de firma de certificado\ndocker.key # Clave privada del certificado\nno-subir.txt # Fichero ignorado por .dockerignore\n.dockerignore\n/web # Directorio con los ficheros de la p\xe1gina web\n")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Dockerfile"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",{parentName:"pre",className:"language-sh"},'FROM centos:7\n\nENV a a\n\nRUN \\\nyum -y install \\\nhttpd \\\nphp \\\nphp-cli \\\nphp-common \\\nmod_ssl \\\nopenssl\n\nRUN echo "<?php phpinfo(); ?>" > /var/www/html/hola.php\n\nCOPY docker.key /docker.key\nCOPY docker.csr /docker.csr\nCOPY ssl.conf /etc/httpd/conf.d/default.conf\nCOPY startbootstrap-grayscale-gh-pages /var/www/html\n\nEXPOSE 443\n\nCMD apachectl -DFOREGROUND\n'))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"dockerignore"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",{parentName:"pre",className:"language-sh"},"no-subir.txt\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"SSL Conf"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",{parentName:"pre",className:"language-conf"},"<VirtualHost *:443>\nServerName localhost\nDocumentRoot /var/www/html\nSSLEngine on\nSSLCertificateFile /docker.csr\nSSLCertificateKeyFile /docker.key\n</VirtualHost>\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"docker.csr"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",{parentName:"pre",className:"language-sh"},"# Tu solicitud de certificado .csr\n"))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"docker.key"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",{parentName:"pre",className:"language-sh"},"# Tu clave privada del certificado\n")))),Object(c.b)("h2",{id:"crear-usuario"},"Crear usuario"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},"FROM centos\n\nENV prueba 1234\n\nRUN useradd ricardo\n")),Object(c.b)("h2",{id:"buenas-pr\xe1cticas"},"Buenas pr\xe1cticas"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},'FROM nginx\n\nENV dir /usr/share/nginx/html/test.txt\n\nRUN \\\n  echo "1" >> $dir && \\\n  echo "2" >> $dir && \\\n  echo "3" >> $dir\n')),Object(c.b)("h2",{id:"centos-systemd"},"CentOS systemd"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},'FROM centos:latest\nENV container docker\nRUN (cd /lib/systemd/system/sysinit.target.wants/; for i in *; do [ $i == \\\nsystemd-tmpfiles-setup.service ] || rm -f $i; done); \\\nrm -f /lib/systemd/system/multi-user.target.wants/*;\\\nrm -f /etc/systemd/system/*.wants/*;\\\nrm -f /lib/systemd/system/local-fs.target.wants/*; \\\nrm -f /lib/systemd/system/sockets.target.wants/*udev*; \\\nrm -f /lib/systemd/system/sockets.target.wants/*initctl*; \\\nrm -f /lib/systemd/system/basic.target.wants/*;\\\nrm -f /lib/systemd/system/anaconda.target.wants/*;\nVOLUME [ "/sys/fs/cgroup" ]\nCMD ["/usr/sbin/init"]\n')),Object(c.b)("h2",{id:"dockerfile-full"},"Dockerfile FULL"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},"# Archivos\nDockerfile\n/web # Tus ficheros de la p\xe1gina web\n")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},'FROM nginx\n\nRUN useradd ruperto\n\nCOPY startbootstrap /usr/share/nginx/html\n\nENV archivo docker\n\nWORKDIR /usr/share/neginx/html\n\nRUN echo "$archivo" > /usr/share/nginx/html/env.html\n\nEXPOSE 90\n\nLABEL version=1\n\nUSER ruperto\n\nRUN echo "Yo soy $(whoami)" > /tmp/yo.html\n\nUSER root\n\nRUN cp /tmp/yo.html /usr/share/nginx/html/docker.html\n\nVOLUME /var/log/nginx\n\nCMD nginx -g \'daemon off;\'\n')),Object(c.b)("h2",{id:"dockerfile-full-2"},"Dockerfile FULL 2"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},"# Archivos\nDockerfile\nrun.sh\n/web\n")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Dockerfile"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",{parentName:"pre",className:"language-sh"},'FROM ubuntu:latest\n\nLABEL version=1.0\nLABEL descripcion="This is an apache image"\nLABEL vendor=yo\n\nRUN apt-get update\n\nRUN apt-get install apache2 -y\n\nWORKDIR /var/www/html\n\nCOPY bootstrap .\n\nENV contenido prueba\n\nRUN echo "$contenido" > /var/www/html/prueba.html\n\nRUN echo "$(whoami)" > /var/www/html/user1.html\n\nRUN useradd ruperto\n\nRUN chown ruperto /mnt -R\n\nUSER ruperto\n\nRUN echo "$(whoami)" > /mnt/user2.html\n\nUSER root\n\nRUN cp /mnt/user2.html /var/www/html/\n\nCOPY run.sh /run.sh\n\nCMD sh /run.sh\n\n'))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"run.sh"),Object(c.b)("pre",{parentName:"li"},Object(c.b)("code",{parentName:"pre",className:"language-sh"},'#!/bin/bash\n\necho "Iniciando container..."\necho "INICIADO!!" > /var/www/html/ini.html\napachectl -DFOREGROUND\n')))),Object(c.b)("h2",{id:"escenarios-m\xfaltiples"},"Escenarios m\xfaltiples"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},"FROM maven:latest as builder\n\nCOPY app /app # app Java\n\nRUN cd /app && mvn package\n\nFROM openjdk:8-alpine\n\nCOPY --from=builder /app/target/jb-hello-world-maven-0.1.0.jar /opt/app.jar\n\nCMD java -jar /opt/app.jar\n")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},"FROM centos as test\n\nRUN fallocate -l 10M /opt/file1\n\nRUN fallocate -l 10M /opt/file2\n\nRUN fallocate -l 10M /opt/file3\n\nFROM alpine\n\nCOPY --from=test /opt/file3 /opt/myfile\n")),Object(c.b)("h2",{id:"nginx-php-fpm"},"NGINX PHP FPM"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},"# Archivos/directorios\n/bin\n    start.sh\n/conf\n    nginx.conf\n    nginx.repo\nDockerfile\nindex.php\n")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"start.sh")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},"#!/bin/bash\n\n# Starts php process in background\n\n/usr/sbin/php-fpm -c /etc/php/fpm\n\n# Starts nginx daemon\n\nnginx -g 'daemon off;'\n")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"nginx.conf")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},'server {\n  listen       80;\n  server_name  localhost;\n  root         /var/www/html;\n  index        index.php;\n  access_log   /var/log/nginx/nginx-access.log;\n  error_log    /var/log/nginx/nginx-error.log;\n\n   gzip on;\n   gzip_static on;\n   gzip_disable "msie6";\n   gzip_http_version 1.1;\n   gzip_vary on;\n   gzip_comp_level 6;\n   gzip_proxied any;\n   gzip_buffers 16 8k;\n   gzip_types\n     text/plain\n     text/css\n     text/x-js\n     text/javascript\n     application/json\n     application/x-javascript\n     application/javascript;\n\n\n  location = /favicon.ico {\n    log_not_found off;\n    access_log off;\n  }\n\n  location = /robots.txt {\n    allow all;\n    log_not_found off;\n    access_log off;\n  }\n\n  location / {\n\n    try_files $uri $uri/ /index.php?$args;\n\n  }\n\n  location ~ \\.php$ {\n\n    try_files $uri =404;\n    include /etc/nginx/fastcgi_params;\n    fastcgi_pass 127.0.0.1:9000;\n    fastcgi_index index.php;\n    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    fastcgi_param PATH_INFO $fastcgi_script_name;\n    fastcgi_intercept_errors on;\n\n  }\n}\n')),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"nginx.repo")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},"[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/centos/7/$basearch/\ngpgcheck=0\nenabled=1\n")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Dockerfile")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},"FROM centos:7\n\nCOPY ./conf/nginx.repo /etc/yum.repos.d/nginx.repo\n\nRUN                                                                          \\\n  yum -y install nginx --enablerepo=nginx                                 && \\\n  yum -y install https://centos7.iuscommunity.org/ius-release.rpm         && \\\n  yum -y install                                                             \\\n    php71u-fpm                                                               \\\n    php71u-cli                                                               \\\n    php71u-mysqlnd                                                           \\\n    php71u-soap                                                              \\\n    php71u-xml                                                               \\\n    php71u-zip                                                               \\\n    php71u-json                                                              \\\n    php71u-mcrypt                                                            \\\n    php71u-mbstring                                                          \\\n    php71u-zip                                                               \\\n    php71u-gd                                                                \\\n     --enablerepo=ius && yum clean all\n\nEXPOSE 80 443\n\nVOLUME /var/www/html /var/log/nginx /var/log/php-fpm /var/lib/php-fpm\n\nCOPY ./conf/nginx.conf /etc/nginx/conf.d/default.conf\n\nCOPY ./bin/start.sh /start.sh\n\nCOPY index.php /var/www/html/index.php\n\nRUN chmod +x /start.sh\n\nCMD /start.sh\n")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"index.php")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-sh"},"<?php phpinfo(); ?>\n")))}p.isMDXComponent=!0},88:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return d}));var r=t(0),a=t.n(r);function c(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){c(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=a.a.createContext({}),p=function(e){var n=a.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=p(e.components);return a.a.createElement(l.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},m=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,c=e.originalType,o=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=p(t),m=r,d=u["".concat(o,".").concat(m)]||u[m]||b[m]||c;return t?a.a.createElement(d,i(i({ref:n},l),{},{components:t})):a.a.createElement(d,i({ref:n},l))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var c=t.length,o=new Array(c);o[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var l=2;l<c;l++)o[l]=t[l];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);